name: CI

on:
  push:
    branches: [main, master]
  pull_request:

env:
  PYTHON_VERSION: "3.10"
  TOKEN: "dummy-token"
  ADMIN_ID: "0"

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      - name: Install root requirements (site)
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then
            python -m pip install -r requirements.txt
          fi

      - name: Install bot requirements
        run: |
          if [ -f mybot/requirements.txt ]; then
            python -m pip install -r mybot/requirements.txt
          fi

      - name: Smoke imports
        env:
          TOKEN: ${{ secrets.TOKEN || env.TOKEN }}
          ADMIN_ID: ${{ secrets.ADMIN_ID || env.ADMIN_ID }}
        run: |
          python - <<'PY'
          from pathlib import Path
          root = Path(__file__).resolve().parent.parent
          if (root / "flask_app.py").exists():
              import flask_app
              print("flask_app import OK")
          else:
              print("flask_app.py not present, skip import")
          import mybot.config
          print("mybot.config import OK")
          PY

